services:
  postgres:
    container_name: '${POSTGRES_CONTAINER_NAME}'
    image: 'postgres:${POSTGRES_VERSION}'
    environment:
      POSTGRES_USER:
      POSTGRES_PASSWORD:
    healthcheck:
      test: [ "CMD", "pg_isready", "--username=${POSTGRES_USER}"]
      interval: 1s
      retries: 5


  backup-service:
    container_name: '${BACKUP_SERVICE_CONTAINER_NAME}'
    build:
      context: '..'
      args:
        ALPINE_VERSION: '${ALPINE_VERSION}'
    depends_on:
      postgres:
        condition: service_healthy

    environment:
      POSTGRES_HOST: postgres
      POSTGRES_DATABASE: '$SEED_DATABASE'
      POSTGRES_USER:
      POSTGRES_PASSWORD:
      S3_ACCESS_KEY_ID:
      S3_SECRET_ACCESS_KEY:
      S3_REGION:
      S3_BUCKET:


      SCHEDULE: '@yearly'
      S3_PREFIX: backup
      # PASSPHRASE: ''
      # BACKUP_KEEP_DAYS: ''
